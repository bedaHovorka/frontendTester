services:
  # Run tests with Chromium (default)
  test-chromium:
    build: .
    volumes:
      - ./.frontend-tester:/app/.frontend-tester
      - ./reports:/app/reports
    environment:
      - FRONTEND_TESTER_BROWSER=chromium
      - FRONTEND_TESTER_HEADLESS=true
    command: uv run frontend-tester run
    networks:
      - frontend-testing

  # Run tests with Firefox
  test-firefox:
    build: .
    volumes:
      - ./.frontend-tester:/app/.frontend-tester
      - ./reports:/app/reports
    environment:
      - FRONTEND_TESTER_BROWSER=firefox
      - FRONTEND_TESTER_HEADLESS=true
    command: uv run frontend-tester run
    networks:
      - frontend-testing

  # Run tests with WebKit
  test-webkit:
    build: .
    volumes:
      - ./.frontend-tester:/app/.frontend-tester
      - ./reports:/app/reports
    environment:
      - FRONTEND_TESTER_BROWSER=webkit
      - FRONTEND_TESTER_HEADLESS=true
    command: uv run frontend-tester run
    networks:
      - frontend-testing

  # Run all browsers sequentially
  test-all:
    build: .
    volumes:
      - ./.frontend-tester:/app/.frontend-tester
      - ./reports:/app/reports
    environment:
      - FRONTEND_TESTER_HEADLESS=true
    command: >
      sh -c "
        uv run frontend-tester run --browser chromium &&
        uv run frontend-tester run --browser firefox &&
        uv run frontend-tester run --browser webkit
      "
    networks:
      - frontend-testing

networks:
  frontend-testing:
    external: true
    name: frontend-testing

# Usage:
# 1. Start the app: cd /home/beda/work/dummy_fe_app && docker-compose up -d
# 2. Run all browsers in parallel: docker-compose up
# 3. Run specific browser: docker-compose up test-chromium
# 4. Run all sequentially: docker-compose up test-all
#
# The test containers can access the app at: http://angularjs-demo-app:3000
